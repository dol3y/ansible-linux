---
- block:
  - name: docker | add key
    apt_key:
      url: https://download.docker.com/linux/ubuntu/gpg
      id: 9DC858229FC7DD38854AE2D88D81803C0EBFCD88
      state: present
    become: yes

  - name: docker | install docker repo
    apt_repository:
      filename: docker
      repo: "deb [arch=amd64] https://download.docker.com/linux/ubuntu {{ ansible_distribution_release }} stable"
      update_cache: yes
      state: present
    become: yes

  - name: docker | install docker
    package:
      name: docker-ce
      state: present
    become: yes

  - name: docker | add docker group
    group:
      name: docker
      state: present
    become: yes

  - name: docker | update group
    user:
      name: "{{ lookup('env','USER') }}"
      append: yes
      groups: docker
    become: yes

  - name: docker | start
    service:
      name: docker
      state: started
      enabled: yes
    become: yes
  tags: docker
